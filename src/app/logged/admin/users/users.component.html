<div *ngIf="this.step == STEPS.LIST" fxFlex="100">
    <cei-card-table [metaData]="this.metaDataUsers" [title]="this.typeUserFilterSelected"
        (page)="onPaginatorEvent($event)">
        <div controlButtons fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="15px">
            <button mat-icon-button matTooltip="Crear usuario" [matMenuTriggerFor]="menuCreate">
                <mat-icon>add</mat-icon>
            </button>
            <button mat-icon-button matTooltip="Refrescar la búsqueda" (click)="this.onRefresh()">
                <mat-icon>refresh</mat-icon>
            </button>
            <mat-icon style="cursor: pointer;" class="text-secondary-darker" [matMenuTriggerFor]="menuSelect">
                more_vert
            </mat-icon>
        </div>
        <cei-text-searching-input filterInputs fxFlex="100" [placeholder]="'Búsqueda rápida'"
            [label]="'Buscar por nombre de usuario'" [inputFilterValue]="this.inputFilterValue"
            (onSearch)="this.inputFilterValue = $event;this.onSearch($event)">
        </cei-text-searching-input>
        <ng-container table *ngIf="!this.isLoadingGetUsers; else loadingDiv">
            <table fxFlex="100" mat-table *ngIf="this?.dataSourceUsers?.data?.length > 0; else emptyTable"
                [dataSource]="dataSourceUsers">
                <!-- Id Column -->
                <ng-container matColumnDef="id" sticky>
                    <th mat-header-cell *matHeaderCellDef>Id</th>
                    <td mat-cell *matCellDef="let user">
                        {{ user.id }}
                    </td>
                </ng-container>
                <!-- Name Column -->
                <ng-container matColumnDef="name" sticky>
                    <th mat-header-cell *matHeaderCellDef>Nombre</th>
                    <td mat-cell *matCellDef="let user">
                        {{ user?.display_name }}
                    </td>
                </ng-container>
                <!-- Email Column -->
                <ng-container matColumnDef="email" sticky>
                    <th mat-header-cell *matHeaderCellDef>E-mail</th>
                    <td mat-cell *matCellDef="let user">
                        {{ user?.email }}
                    </td>
                </ng-container>
                <!-- Dni Column -->
                <ng-container matColumnDef="dni" sticky>
                    <th mat-header-cell *matHeaderCellDef>DNI</th>
                    <td mat-cell *matCellDef="let user">
                        {{ user?.dni }}
                    </td>
                </ng-container>
                <!-- Role Column -->
                <ng-container matColumnDef="role" sticky>
                    <th mat-header-cell *matHeaderCellDef>Rol</th>
                    <td mat-cell *matCellDef="let user">
                        {{ user?.typeText }}
                    </td>
                </ng-container>
                <!-- Disabled Column -->
                <ng-container matColumnDef="disabled" sticky>
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let user">
                        <mat-icon [ngClass]="{'text-warn': user?.disabled, 'text-primary': !user?.disabled }"
                            [matTooltip]="user?.disabled ? 'Usuario deshabilitado':'Usuario habilitado'">
                            {{ user?.disabled ? 'highlight_alt' : 'done'}}
                        </mat-icon>
                    </td>
                </ng-container>
                <!-- Verified Column -->
                <ng-container matColumnDef="verified" sticky>
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let user">
                        <mat-icon
                            [ngClass]="{'text-warn': !user?.email_verified, 'text-primary': user?.email_verified }"
                            [matTooltip]="user?.email_verified ? 'Email verificado':'Email no verificado'">
                            {{ user?.email_verified ? 'verified_user': 'unpublished'}}
                        </mat-icon>
                    </td>
                </ng-container>
                <!-- Actions Column -->
                <ng-container matColumnDef="actions" sticky>
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let user">
                        <button mat-button (click)="onEditUser(user)">
                            <mat-icon class="text-primary" [matTooltip]="'Editar usuario'">
                                edit
                            </mat-icon>
                        </button>
                    </td>
                </ng-container>
                <!-- Campus Column -->
                <ng-container matColumnDef="campus" sticky>
                    <th mat-header-cell *matHeaderCellDef>Sede</th>
                    <td mat-cell *matCellDef="let user">
                        {{ user?.campus?.name }}
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns" class="bg-on-hover">
                </tr>
            </table>
        </ng-container>

    </cei-card-table>
</div>

<div fxFlex="100" *ngIf="this.step == STEPS.CREATE_OR_EDIT">
    <cei-create-edit-user [typeUserSelected]="this.typeUserFilterSelectedPost" fxFlex="100" [user]="this.selectedUser"
        (created)="this.fromCreateOrEditToList(true)" (cancelled)="this.fromCreateOrEditToList(false)">
    </cei-create-edit-user>
</div>

<ng-template #loadingDiv>
    <app-spinner fxFlex="100" fxLayoutAlign="center start"></app-spinner>
</ng-template>
<ng-template #emptyTable>
    <span fxFlex="100" fxLayoutAlign="center">
        No se encontraron usuarios con el filtro aplicado
    </span>
</ng-template>

<mat-menu #menuSelect="matMenu">
    <button mat-menu-item [disabled]="this.typeUserFilterSelected == typeUserFilter.ALL"
        (click)="onTypeUserFilter(typeUserFilter.ALL)">
        <mat-icon>person</mat-icon>
        <span>{{typeUserFilter.ALL}}</span>
    </button>
    <button mat-menu-item [disabled]="this.typeUserFilterSelected == typeUserFilter.ADMIN"
        (click)="onTypeUserFilter(typeUserFilter.ADMIN)">
        <mat-icon>group</mat-icon>
        <span>{{typeUserFilter.ADMIN}}</span>
    </button>
    <button mat-menu-item [disabled]="this.typeUserFilterSelected == typeUserFilter.STUDENT"
        (click)="onTypeUserFilter(typeUserFilter.STUDENT)">
        <mat-icon>group</mat-icon>
        <span>{{typeUserFilter.STUDENT}}</span>
    </button>
    <button mat-menu-item [disabled]="this.typeUserFilterSelected == typeUserFilter.PROFESSOR_SHIP"
        (click)="onTypeUserFilter(typeUserFilter.PROFESSOR_SHIP)">
        <mat-icon>group</mat-icon>
        <span>{{typeUserFilter.PROFESSOR_SHIP}}</span>
    </button>
    <button mat-menu-item [disabled]="this.typeUserFilterSelected == typeUserFilter.SCHOLARSHIP"
        (click)="onTypeUserFilter(typeUserFilter.SCHOLARSHIP)">
        <mat-icon>group</mat-icon>
        <span>{{typeUserFilter.SCHOLARSHIP}}</span>
    </button>
    <button mat-menu-item [disabled]="this.typeUserFilterSelected == typeUserFilter.CAMPUS_USER"
        (click)="onTypeUserFilter(typeUserFilter.CAMPUS_USER)">
        <mat-icon>group</mat-icon>
        <span>{{typeUserFilter.CAMPUS_USER}}</span>
    </button>
</mat-menu>
<mat-menu #menuCreate="matMenu">
    <button mat-menu-item
        (click)="this.typeUserFilterSelectedPost = typeUserFilter.ADMIN; this.step = STEPS.CREATE_OR_EDIT">
        <mat-icon>group</mat-icon>
        <span>{{typeUserFilter.ADMIN}}</span>
    </button>
    <button mat-menu-item
        (click)="this.typeUserFilterSelectedPost = typeUserFilter.PROFESSOR_SHIP; this.step = STEPS.CREATE_OR_EDIT">
        <mat-icon>group</mat-icon>
        <span>{{typeUserFilter.PROFESSOR_SHIP}}</span>
    </button>
    <button mat-menu-item
        (click)="this.typeUserFilterSelectedPost = typeUserFilter.CAMPUS_USER; this.step = STEPS.CREATE_OR_EDIT">
        <mat-icon>group</mat-icon>
        <span>{{typeUserFilter.CAMPUS_USER}}</span>
    </button>
</mat-menu>